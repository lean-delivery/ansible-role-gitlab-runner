---
- name: Add universe repository for Ubuntu
  apt_repository:
    repo: "deb http://archive.ubuntu.com/ubuntu {{ ansible_distribution_release }} universe"
    state: present
  when: ansible_distribution == 'Ubuntu'
  become: true

- name: Install EPEL repo
  yum:
    name: https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
    state: present
  register: epel_repo_install
  until: epel_repo_install is succeeded
  become: true
  when:
    - ansible_os_family == "RedHat"
    - ansible_distribution_major_version == '8'

- name: Enable PowerTools repo
  yum_repository:
    name: PowerTools
    enabled: true
    state: present
    mirrorlist: http://mirrorlist.centos.org/?release=8&arch=x86_64&repo=PowerTools&infra=stock
    baseurl: http://mirror.cs.vt.edu/pub/CentOS/8.0.1905/PowerTools/x86_64/os/
  when:
    - ansible_os_family == "RedHat"
    - ansible_distribution_major_version == '8'

- name: Install required packages
  package:
    name: '{{ packages_base | union(packages_additional) | unique }}'
    state: present
  register: installed_packages
  until: installed_packages is succeeded
  become: true

- name: Install requried pip packages
  pip:
    name: '{{ pip_packages }}'
    state: present
  register: installed_packages
  until: installed_packages is succeeded
  become: true
  when:
    - ansible_os_family == "RedHat"
    - ansible_distribution_major_version == '8'
