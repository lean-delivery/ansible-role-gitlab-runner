---
- name: Add universe repository for Ubuntu
  apt_repository:
    repo: "deb http://archive.ubuntu.com/ubuntu {{ ansible_distribution_release }} universe"
    state: present
  when: ansible_distribution == 'Ubuntu'
  become: true
  tags:
    - always

- name: Install required packages
  package:
    name: '{{ packages_base | union(packages_additional) | unique }}'
    state: present
  register: installed_packages
  until: installed_packages is succeeded
  become: true
  tags:
    - always

- name: Install packages on centos
  yum:
    name: python-pip
    state: present
  retries: 300
  delay: 20
  when: ansible_distribution == 'CentOS' or ansible_distribution == 'Red Hat Enterprise Linux'
  register: pip_installed_centos
  until: pip_installed_centos is succeeded
  become: true
  tags:
    - always

- name: Install packages on ubuntu
  apt:
    name: python-pip
    state: present
  retries: 300
  delay: 20
  when: ansible_distribution == 'Ubuntu'
  register: pip_installed_ubuntu
  until: pip_installed_ubuntu is succeeded
  become: true
  tags:
    - always

- name: Install Python gitlab module
  pip:
    name: python-gitlab
    state: present
  register: pip_result
  until: pip_result is succeeded
  become: true
  tags:
    - always
